# -*- shell-script -*-
function run ()
{
    local files=( \
	sdk.apk \
	out/sdk/public.xml \
	out/sdk/classes.dex \
	out/sdk/_.pack \
	out/sdk/_.signed \
	out/sdk/_.unsigned \
	out/sdk/res/org/smart/test/ASDK/R.java \
	out/sdk/classes/org/smart/test/ASDK/Foo.class \
	out/sdk/classes/org/smart/test/ASDK/R.class \
	out/sdk/classes/org/smart/test/ASDK/R\$attr.class \
	out/sdk/classes/org/smart/test/ASDK/R\$layout.class \
	out/sdk/classes/org/smart/test/ASDK/R\$string.class \
	out/objs/android-14-armeabi-v7a/jni/jni.o \
	out/libs/armeabi-v7a/jni.so \
	)

    rm -rf ${files[@]} out

    local lines=$(smart)
    check-files files

    if false; then
	echo "=================================================="
	echo "$lines"
	echo "=================================================="
    fi

    lines=( $(jar -t < sdk.apk) )
    files=( \
	META-INF/MANIFEST.MF \
	META-INF/CERT.SF \
	META-INF/CERT.RSA \
	res/layout/main.xml \
	AndroidManifest.xml \
	resources.arsc \
	classes.dex \
	lib/armeabi-v7a/jni.so \
	)

    is-same-set lines files || error "wrong APK"
}
