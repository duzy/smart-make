# -*- makefile-gmake -*-
#
#    Copyright (C) 2012, Duzy Chan <code@duzy.info>
#    All rights reserved.
#
#####################################################
#
#  smart.require - Load a subdir under SRCDIR.
#  
#  @param: name
#
$(smart.internal)

ifndef @name
  smart~error := @name is undefined
else

ifndef smart.scripts.$(@name)
  smart~error := no script for "$(@name) (by $(NAME), $(SM.MK))"
else

smart~scripts := $(smart.scripts.$(@name))
smart~names := $(filter-out \
  SM.MK NAME SRCDIR SUBDIRS REQUIRES PROGRAMS LIBRARIES,\
  $(smart.context.names))

#$(warning info: "$(NAME)" requires "$(@name), $(smart~scripts)")
#$(warning info: EXPORTS: $(filter smart.context.EXPORT.%-$(smart~scripts),$(.VARIABLES)))
#$(warning info: EXPORTS: $(filter smart.context.EXPORT.%,$(.VARIABLES)))

define smart~require
$(eval \
  ifdef smart.context.EXPORT.$(smart~name)-$(smart~sm.mk)
    $(smart~name) += $(smart.context.EXPORT.$(smart~name)-$(smart~sm.mk))
  endif
 )
endef #smart~require

$(foreach smart~sm.mk,$(smart~scripts),\
    $(foreach smart~name,$(smart~names),$(smart~require))\
    $(eval module-$(SM.MK): module-$(smart~sm.mk)))

endif #smart.scripts.$(@name)
endif #@name

smart~require :=
smart~scripts :=
smart~names :=
smart~name :=
@name :=
